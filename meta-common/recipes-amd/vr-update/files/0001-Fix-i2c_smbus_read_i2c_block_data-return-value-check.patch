From e2bdcfa45623f652280c6b8fbc3eaa84ba742433 Mon Sep 17 00:00:00 2001
From: Illia Volchanetskyi <Illia_Volchanetskyi6439@jabil.com>
Date: Wed, 19 Jun 2024 10:48:32 +0300
Subject: [PATCH] Fix i2c_smbus_read_i2c_block_data return value check

---
 src/vr_update_mps.cpp     | 6 +++---
 src/vr_update_mps285x.cpp | 4 ++--
 2 files changed, 5 insertions(+), 5 deletions(-)

diff --git a/src/vr_update_mps.cpp b/src/vr_update_mps.cpp
index 7a6f260..bfd2cbb 100644
--- a/src/vr_update_mps.cpp
+++ b/src/vr_update_mps.cpp
@@ -29,7 +29,7 @@ bool vr_update_mps::crcCheckSum(){
      }
 
     ret = i2c_smbus_read_i2c_block_data(fd, CRC_ADDR, BYTE_COUNT_4, rdata);
-    if (rdata < SUCCESS)
+    if (ret < SUCCESS)
     {
            sd_journal_print(LOG_ERR, "Error: Reading CRC from device failed\n");
            return false;
@@ -80,7 +80,7 @@ bool vr_update_mps::isUpdatable(){
 
     ret = i2c_smbus_read_i2c_block_data(fd, DEVICE_ID_REG, BYTE_COUNT_2, rdata); 
 
-    if(rdata >= SUCCESS)
+    if(ret >= SUCCESS)
     {
         VrDeviceId = (rdata[INDEX_0] << SHIFT_8) | rdata[INDEX_1];
     }
@@ -92,7 +92,7 @@ bool vr_update_mps::isUpdatable(){
 
     ret = i2c_smbus_read_i2c_block_data(fd, CONFIG_ID_REG, BYTE_COUNT_3, rdata);
 
-    if(rdata >= SUCCESS)
+    if(ret >= SUCCESS)
     {
         VrConfigId = (rdata[INDEX_0] << SHIFT_16) | (rdata[INDEX_1] << SHIFT_8) | rdata[INDEX_2];
     }
diff --git a/src/vr_update_mps285x.cpp b/src/vr_update_mps285x.cpp
index caa3ae9..729dc82 100644
--- a/src/vr_update_mps285x.cpp
+++ b/src/vr_update_mps285x.cpp
@@ -53,7 +53,7 @@ bool vr_update_mps285x::isUpdatable()
     /*Device ID ID from 9Ah@page0*/
     ret = i2c_smbus_read_i2c_block_data(fd, DEVICE_ID_REG, BYTE_COUNT_4, rdata);
 
-    if(rdata >= SUCCESS)
+    if(ret >= SUCCESS)
     {
         VrDeviceId = ((uint16_t)rdata[INDEX_2] << SHIFT_8) | rdata[INDEX_1];
     }
@@ -66,7 +66,7 @@ bool vr_update_mps285x::isUpdatable()
     /*Config ID from 9Dh@page0*/
     ret = i2c_smbus_read_i2c_block_data(fd, CONFIG_ID_REG, BYTE_COUNT_4, rdata);
 
-    if(rdata >= SUCCESS)
+    if(ret >= SUCCESS)
     {
         VrConfigId = ((uint16_t)rdata[INDEX_2] << SHIFT_8) | rdata[INDEX_1];
     }
